<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PICKLEBALL SCORE - ĐỨC TRỌNG</title>
  <style>
    :root{--bg:#f6f8fb;--card:#fff;--accent:#0b74da;--muted:#6b7280;--teamA:#ff7a7a;--teamB:#60a5fa;--kitchen:#ffdca8}
    *{box-sizing:border-box;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial}
    body{margin:0;background:linear-gradient(180deg,#eef6ff 0%, #fbfdff 100%);color:#0f172a}
    header{padding:18px 12px;text-align:center}
    h1{margin:0;font-size:20px;color:var(--accent);text-shadow:0 2px 6px rgba(11,116,218,0.25);letter-spacing:1px}
    .container{max-width:1000px;margin:18px auto;padding:16px}
    .controls{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px}
    .card{background:var(--card);border-radius:10px;padding:12px;box-shadow:0 6px 18px rgba(15,23,42,0.06);flex:1;min-width:240px}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    select,input[type=text]{width:100%;padding:8px;border-radius:6px;border:1px solid #e6e9ef}
    .scoreboard{display:flex;gap:12px;margin-top:12px}
    .team{flex:1;padding:12px;border-radius:8px;background:linear-gradient(180deg,#ffffff,#fbfdff);text-align:center}
    .team h2{margin:0;font-size:14px}
    .points{font-size:58px;font-weight:700;margin:8px 0}
    .pt-controls{display:flex;gap:8px;justify-content:center}
    button{padding:8px 12px;border-radius:8px;border:0;background:var(--accent);color:white;cursor:pointer}
    .btn-secondary{background:#eef2ff;color:var(--accent);border:1px solid rgba(11,116,218,0.06)}
    .muted{color:var(--muted);font-size:13px}

    /* Court horizontal layout */
    .court{margin-top:18px;display:flex;gap:12px;align-items:center}
    .court-visual{flex:1;background:linear-gradient(180deg,#e6f2ff,#f8fbff);border-radius:10px;padding:14px;border:1px solid rgba(11,116,218,0.06)}
    .court-grid{position:relative;height:360px;background:#eaf6ff;border-radius:8px;margin:0 auto;max-width:880px;box-shadow:inset 0 2px 0 rgba(255,255,255,0.6);overflow:hidden}

    /* Net vertical in center */
    .net{position:absolute;left:50%;top:2%;bottom:2%;width:6px;background:linear-gradient(180deg,#333, #888);transform:translateX(-50%);opacity:0.9;border-radius:3px}

    /* Kitchen zones (non-volley) as rectangles adjacent to net */
    .kitchen-left{position:absolute;left:35%;top:5%;bottom:5%;width:15%;background:var(--kitchen);opacity:0.9;border-radius:6px;display:flex;align-items:center;justify-content:center}
    .kitchen-right{position:absolute;right:35%;top:5%;bottom:5%;width:15%;background:var(--kitchen);opacity:0.9;border-radius:6px;display:flex;align-items:center;justify-content:center}
    .kitchen-label{font-size:12px;color:#6b4a00;font-weight:600}

    .position{position:absolute;width:18%;height:30%;display:flex;align-items:center;justify-content:center;border-radius:8px}
    .pos-box{background:rgba(255,255,255,0.95);width:92%;height:80%;display:flex;flex-direction:column;align-items:center;justify-content:center;border-radius:8px;padding:6px;border:1px solid rgba(15,23,42,0.05)}
    .pos-label{font-size:12px;color:var(--muted)}
    .player-name{font-weight:700}
    .server{box-shadow:0 0 0 4px rgba(11,116,218,0.12);border:2px solid var(--accent)}

    /* Team color accents */
    .teamA-accent{background:linear-gradient(180deg, rgba(255,122,122,0.08), rgba(255,122,122,0.02));border:1px solid rgba(255,122,122,0.12)}
    .teamB-accent{background:linear-gradient(180deg, rgba(96,165,250,0.08), rgba(96,165,250,0.02));border:1px solid rgba(96,165,250,0.12)}

    .controls-small{display:flex;gap:8px;align-items:center}
    .tiny{font-size:12px;padding:6px 8px}
    .footer{margin-top:12px;text-align:center;color:var(--muted);font-size:13px}
    @media(max-width:980px){.court-grid{height:260px}}
  </style>
</head>
<body>
  <header>
    <h1>PICKLEBALL SCORE - ĐỨC TRỌNG</h1>
  </header>
  <div class="container">
    <div class="controls">
      <div class="card" style="min-width:260px">
        <label>Chọn thang điểm</label>
        <select id="targetSelect">
          <option value="11">11 điểm</option>
          <option value="15">15 điểm</option>
        </select>
        <div style="height:8px"></div>
        <label>Cách xác định thắng</label>
        <div style="display:flex;gap:8px;align-items:center">
          <label><input type="radio" name="winMode" value="winBy2" checked> Cách 2 điểm</label>
          <label><input type="radio" name="winMode" value="touch"> Chạm điểm</label>
        </div>
        <div style="height:8px"></div>
        <label>Hiện trạng giao</label>
        <div class="muted">Server hiện tại: <span id="serverStatus">Team A - A_LEFT (A1)</span></div>
        <div style="height:8px"></div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="resetBtn" class="btn-secondary tiny">Reset</button>
          <button id="swapSides" class="btn-secondary tiny">Đổi đội</button>
        </div>
      </div>

      <div class="card">
        <label>Tên vận động viên (gắn vị trí trên sân)</label>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
          <div>
            <label class="muted">Đội A - Vị trí Trên</label>
            <input id="a_top" type="text" value="A1" />
          </div>
          <div>
            <label class="muted">Đội A - Vị trí Dưới</label>
            <input id="a_bottom" type="text" value="A2" />
          </div>
          <div>
            <label class="muted">Đội B - Vị trí Trên</label>
            <input id="b_top" type="text" value="B1" />
          </div>
          <div>
            <label class="muted">Đội B - Vị trí Dưới</label>
            <input id="b_bottom" type="text" value="B2" />
          </div>
        </div>
      </div>

      <div class="card" style="min-width:240px">
        <label>Ghi chú & nút nhanh</label>
        <div class="muted" style="margin-bottom:8px">- Sân xoay ngang: Team A bên trái, Team B bên phải. Có lưới ở giữa và khu vực 'kitchen' (non-volley) gần lưới. Giao nội bộ: 2 lượt mỗi đội. Server sẽ đổi vị trí nội bộ sau mỗi điểm khi cùng đội đang giao.</div>
        <div style="display:flex;gap:8px">
          <button id="undo" class="btn-secondary tiny">Hoàn tác</button>
          <button id="saveState" class="btn-secondary tiny">Sao chép trạng thái</button>
        </div>
      </div>
    </div>

    <div class="scoreboard">
      <div class="team card teamA-accent" id="teamA">
        <h2>ĐỘI A</h2>
        <div class="points" id="scoreA">0</div>
        <div class="pt-controls">
          <button id="aPlus">+1</button>
          <button id="aMinus" class="btn-secondary">-1</button>
        </div>
        <div style="height:8px"></div>
        <div class="muted">Lượt giao nội bộ: <span id="aServeCount">0</span></div>
      </div>

      <div class="team card teamB-accent" id="teamB">
        <h2>ĐỘI B</h2>
        <div class="points" id="scoreB">0</div>
        <div class="pt-controls">
          <button id="bPlus">+1</button>
          <button id="bMinus" class="btn-secondary">-1</button>
        </div>
        <div style="height:8px"></div>
        <div class="muted">Lượt giao nội bộ: <span id="bServeCount">0</span></div>
      </div>
    </div>

    <div class="court">
      <div class="court-visual card">
        <div class="court-grid" id="courtGrid">
          <div class="net" title="Lưới"></div>

          <div class="kitchen-left"><div class="kitchen-label">KITCHEN</div></div>
          <div class="kitchen-right"><div class="kitchen-label">KITCHEN</div></div>

          <!-- Team A (left side) -->
          <div class="position" id="pos-a-top" style="left:4%;top:12%;">
            <div class="pos-box" id="box-a-top"><div class="pos-label">A - TOP</div><div class="player-name" id="name-a-top">A1</div></div>
          </div>
          <div class="position" id="pos-a-bottom" style="left:4%;bottom:12%;">
            <div class="pos-box" id="box-a-bottom"><div class="pos-label">A - BOTTOM</div><div class="player-name" id="name-a-bottom">A2</div></div>
          </div>

          <!-- Team B (right side) -->
          <div class="position" id="pos-b-top" style="right:4%;top:12%;">
            <div class="pos-box" id="box-b-top"><div class="pos-label">B - TOP</div><div class="player-name" id="name-b-top">B1</div></div>
          </div>
          <div class="position" id="pos-b-bottom" style="right:4%;bottom:12%;">
            <div class="pos-box" id="box-b-bottom"><div class="pos-label">B - BOTTOM</div><div class="player-name" id="name-b-bottom">B2</div></div>
          </div>

        </div>
      </div>
    </div>

    <div class="footer">Chạy trên trình duyệt - không lưu dữ liệu. Copy/Share trạng thái bằng nút 'Sao chép trạng thái'.</div>
  </div>

<script>
(function(){
  // State
  const state = { scoreA:0, scoreB:0, serveSide:'A', serverIndex:0, serverCount:1, history: [] };

  // Elements
  const el = id=>document.getElementById(id);
  const scoreA = el('scoreA'), scoreB = el('scoreB');
  const aPlus = el('aPlus'), aMinus = el('aMinus'), bPlus = el('bPlus'), bMinus = el('bMinus');
  const serverStatus = el('serverStatus');
  const aServeCount = el('aServeCount'), bServeCount = el('bServeCount');
  const inputs = { a_top:el('a_top'), a_bottom:el('a_bottom'), b_top:el('b_top'), b_bottom:el('b_bottom') };
  const names = { 'a_top':el('name-a-top'),'a_bottom':el('name-a-bottom'),'b_top':el('name-b-top'),'b_bottom':el('name-b-bottom') };
  const boxes = { 'a_top':el('box-a-top'),'a_bottom':el('box-a-bottom'),'b_top':el('box-b-top'),'b_bottom':el('box-b-bottom') };
  const targetSelect = el('targetSelect');
  const resetBtn = el('resetBtn');
  const winModeRadios = document.getElementsByName('winMode');
  const undoBtn = el('undo');
  const copyBtn = el('saveState');
  const swapSidesBtn = el('swapSides');

  function pushHistory(){ state.history.push(JSON.stringify({scoreA:state.scoreA,scoreB:state.scoreB,serveSide:state.serveSide,serverIndex:state.serverIndex,serverCount:state.serverCount})); if(state.history.length>80) state.history.shift(); }
  function undo(){ if(!state.history.length) return; const raw=state.history.pop(); const h=JSON.parse(raw); state.scoreA=h.scoreA; state.scoreB=h.scoreB; state.serveSide=h.serveSide; state.serverIndex=h.serverIndex; state.serverCount=h.serverCount; render(); }
  function getWinMode(){ return Array.from(winModeRadios).find(r=>r.checked).value; }
  function getTarget(){ return Number(targetSelect.value); }
  function capFor(target, mode){ if(mode==='winBy2'){ return target===11?15:21; } return target; }

  function checkGameEnd(){ const target=getTarget(); const mode=getWinMode(); const cap=capFor(target,mode);
    if(mode==='touch'){ if(state.scoreA>=target && state.scoreA>state.scoreB) return 'A'; if(state.scoreB>=target && state.scoreB>state.scoreA) return 'B'; return null; }
    if(state.scoreA>=target || state.scoreB>=target){ if(Math.abs(state.scoreA-state.scoreB)>=2){ if(state.scoreA>state.scoreB && state.scoreA<=cap) return 'A'; if(state.scoreB>state.scoreA && state.scoreB<=cap) return 'B'; }
      if(state.scoreA>=cap || state.scoreB>=cap){ if(state.scoreA>state.scoreB) return 'A'; if(state.scoreB>state.scoreA) return 'B'; } }
    return null;
  }

  function updateServerStatus(){ const side = state.serveSide; const playerKey = side==='A' ? (state.serverIndex===0? 'a_top':'a_bottom') : (state.serverIndex===0? 'b_top':'b_bottom'); serverStatus.textContent = `Team ${side} - ${playerKey.toUpperCase()} (${inputs[playerKey].value})`; aServeCount.textContent = state.serveSide==='A'? state.serverCount:0; bServeCount.textContent = state.serveSide==='B'? state.serverCount:0; Object.values(boxes).forEach(b=>b.classList.remove('server')); boxes[playerKey].classList.add('server'); }

  function render(){ scoreA.textContent = state.scoreA; scoreB.textContent = state.scoreB; names['a_top'].textContent = inputs['a_top'].value || 'A1'; names['a_bottom'].textContent = inputs['a_bottom'].value || 'A2'; names['b_top'].textContent = inputs['b_top'].value || 'B1'; names['b_bottom'].textContent = inputs['b_bottom'].value || 'B2'; updateServerStatus(); const winner = checkGameEnd(); if(winner){ setTimeout(()=>{ alert('Kết thúc trận: Đội ' + winner + ' thắng!'); },50); } }

  function addPoint(team){ pushHistory(); if(team==='A'){ state.scoreA++; if(state.serveSide==='A'){ state.serverIndex = 1 - state.serverIndex; state.serverCount = state.serverCount%2 + 1; } else { state.serveSide='A'; state.serverIndex=0; state.serverCount=1; } } else { state.scoreB++; if(state.serveSide==='B'){ state.serverIndex = 1 - state.serverIndex; state.serverCount = state.serverCount%2 + 1; } else { state.serveSide='B'; state.serverIndex=0; state.serverCount=1; } } render(); }
  function subPoint(team){ pushHistory(); if(team==='A') state.scoreA = Math.max(0, state.scoreA-1); else state.scoreB = Math.max(0, state.scoreB-1); render(); }

  function swapSides(){ pushHistory(); // swap names and scores
    const tmpAt = inputs.a_top.value; inputs.a_top.value = inputs.b_top.value; inputs.b_top.value = tmpAt;
    const tmpAb = inputs.a_bottom.value; inputs.a_bottom.value = inputs.b_bottom.value; inputs.b_bottom.value = tmpAb;
    const tmpScore = state.scoreA; state.scoreA = state.scoreB; state.scoreB = tmpScore; state.serveSide = state.serveSide==='A'?'B':'A'; render(); }

  async function copyState(){ const payload = { scoreA: state.scoreA, scoreB: state.scoreB, serveSide: state.serveSide, serverIndex: state.serverIndex, a_top: inputs.a_top.value, a_bottom: inputs.a_bottom.value, b_top: inputs.b_top.value, b_bottom: inputs.b_bottom.value, target:getTarget(), mode:getWinMode() }; try{ await navigator.clipboard.writeText(JSON.stringify(payload)); alert('Đã sao chép trạng thái (JSON) vào clipboard.'); }catch(e){ prompt('Copy thủ công (Ctrl+C):', JSON.stringify(payload)); } }

  // wiring
  aPlus.addEventListener('click',()=>addPoint('A')); bPlus.addEventListener('click',()=>addPoint('B')); aMinus.addEventListener('click',()=>subPoint('A')); bMinus.addEventListener('click',()=>subPoint('B'));
  resetBtn.addEventListener('click',()=>{ if(!confirm('Reset toàn bộ trạng thái?')) return; pushHistory(); state.scoreA=0; state.scoreB=0; state.serveSide='A'; state.serverIndex=0; state.serverCount=1; state.history=[]; render(); });
  undoBtn.addEventListener('click',undo); copyBtn.addEventListener('click',copyState); swapSidesBtn.addEventListener('click',swapSides);
  Object.keys(inputs).forEach(k=>inputs[k].addEventListener('input',render));

  render();
})();
</script>
</body>
</html>
