<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>PICKLEBALL SCORE - Äá»¨C TRá»ŒNG</title>
<style>
  :root{
    --bg: #f4f6f9;
    --card: #fff;
    --muted: #6b7280;
    --teamA: #ff6b6b;
    --teamB: #2ba6ff;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,Arial,Helvetica,sans-serif;background:var(--bg);-webkit-text-size-adjust:100%}
  .app{max-width:980px;margin:14px auto;padding:12px}
  header{display:flex;justify-content:space-between;align-items:center;gap:12px}
  h1{margin:0;background:#083d9a;color:#fff;padding:10px 14px;border-radius:8px;font-size:18px}
  .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  select,input{padding:8px;border-radius:8px;border:1px solid #d7dde6}
  .btn{padding:8px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:700}
  .btn.green{background:#00a850;color:#fff}
  .layout{display:flex;gap:12px;margin-top:12px}
  .left{width:360px;background:var(--card);padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
  .right{flex:1;background:var(--card);padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
  .teamBox{padding:10px;border-radius:8px;margin-bottom:10px;border-left:8px solid #ddd;background:#fbfbfb}
  .teamA{border-left-color:var(--teamA)} .teamB{border-left-color:var(--teamB)}
  .small{font-size:13px;color:var(--muted)}
  .bigScore{font-size:28px;font-weight:900}
  .courtWrap{display:flex;justify-content:center;align-items:center;padding:8px}
  .court{width:540px;height:300px;background:#cfeed3;border:3px solid #2b4b2b;border-radius:8px;position:relative;display:flex;flex-direction:row;overflow:hidden}
  .net{position:absolute;left:0;right:0;top:50%;height:4px;background:#333}
  .kitchen.top{position:absolute;left:0;right:0;top:0;height:90px;background:rgba(255,200,200,0.35);border-bottom:2px dashed rgba(0,0,0,0.08)}
  .kitchen.bottom{position:absolute;left:0;right:0;bottom:0;height:90px;background:rgba(255,200,200,0.35);border-top:2px dashed rgba(0,0,0,0.08)}
  .side{width:50%;display:flex;flex-direction:column;justify-content:space-around;align-items:center;padding:8px}
  .playerBox{width:160px;height:44px;border-radius:8px;background:#fff;display:flex;align-items:center;justify-content:center;font-weight:800;border:2px solid transparent;transition:transform .18s, box-shadow .18s}
  .A{color:var(--teamA);border-color:rgba(255,107,107,0.15)}
  .B{color:var(--teamB);border-color:rgba(43,166,255,0.15)}
  .server{background:#ffecec;border-color:#ff3b3b !important;color:#9b0a0a; transform:scale(1.06); box-shadow:0 12px 28px rgba(0,0,0,0.12)}
  .board{margin:12px auto;text-align:center}
  .mainBoard{display:inline-block;background:#fff;padding:8px 14px;border-radius:8px;font-weight:900}
  .controlsRow{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  button.small{padding:8px 10px;border-radius:8px;border:0;cursor:pointer}
  .muted{color:var(--muted);font-size:13px}
  .flex-between{display:flex;justify-content:space-between;align-items:center}
  @media (max-width:880px){.layout{flex-direction:column}.left{width:100%}.court{width:100%}}
  input.small{padding:8px;border-radius:8px;border:1px solid #ddd}
</style>
</head>
<body>
<div class="app">
  <header>
    <h1>PICKLEBALL SCORE - Äá»¨C TRá»ŒNG</h1>
    <div class="controls">
      <label class="small">Thang Ä‘iá»ƒm</label>
      <select id="pointType"><option value="11">11</option><option value="15">15</option></select>

      <label class="small">Kiá»ƒu tháº¯ng</label>
      <select id="winType"><option value="touch">Cháº¡m</option><option value="by2">CÃ¡ch 2</option></select>

      <label class="small">Äá»™i giao Ä‘áº§u</label>
      <select id="firstServe"><option value="A">Äá»™i A</option><option value="B">Äá»™i B</option></select>

      <button class="btn green" onclick="startMatch()">Báº®T Äáº¦U</button>
    </div>
  </header>

  <div class="layout">
    <!-- LEFT -->
    <div class="left">
      <div class="teamBox teamA">
        <div class="flex-between">
          <div>
            <div style="font-weight:900">Äá»™i A</div>
            <div class="small">TÃªn Ä‘á»™i: <input id="teamAName" class="small" value="TEAM A"></div>
          </div>
          <div style="text-align:right">
            <div class="small">Äiá»ƒm</div>
            <div id="scoreA" class="bigScore">0</div>
          </div>
        </div>
        <div style="margin-top:8px">
          <div class="small">VÄV (pháº£i / trÃ¡i)</div>
          <input id="A_right_name" class="small" value="A - Pháº£i" style="width:100%;margin-top:6px">
          <input id="A_left_name"  class="small" value="A - TrÃ¡i"  style="width:100%;margin-top:6px">
        </div>
      </div>

      <div class="teamBox teamB">
        <div class="flex-between">
          <div>
            <div style="font-weight:900">Äá»™i B</div>
            <div class="small">TÃªn Ä‘á»™i: <input id="teamBName" class="small" value="TEAM B"></div>
          </div>
          <div style="text-align:right">
            <div class="small">Äiá»ƒm</div>
            <div id="scoreB" class="bigScore">0</div>
          </div>
        </div>
        <div style="margin-top:8px">
          <div class="small">VÄV (pháº£i / trÃ¡i)</div>
          <input id="B_right_name" class="small" value="B - Pháº£i" style="width:100%;margin-top:6px">
          <input id="B_left_name"  class="small" value="B - TrÃ¡i"  style="width:100%;margin-top:6px">
        </div>
      </div>

      <div style="margin-top:10px">
        <div class="muted">Báº£ng chÃ­nh (Ä‘iá»ƒm Ä‘á»™i Ä‘ang giao - Ä‘iá»ƒm Ä‘á»‘i phÆ°Æ¡ng - lÆ°á»£t giao hiá»‡n táº¡i)</div>
        <div class="board" style="margin-top:8px">
          <div id="mainBoard" class="mainBoard">0 - 0 - 0</div>
        </div>
        <div style="margin-top:8px" class="muted">Ghi chÃº: Ä‘á»™i giao Ä‘áº§u tráº­n báº¯t Ä‘áº§u S=2 (vÃ­ dá»¥ 0-0-2). CÃ¡c quy táº¯c khÃ¡c theo mÃ´ táº£.</div>
      </div>
    </div>

    <!-- RIGHT -->
    <div class="right">
      <div class="flex-between">
        <div style="font-weight:900">SÆ¡ Ä‘á»“ sÃ¢n (ngang)</div>
        <div style="text-align:right">
          <div class="small">Server hiá»‡n táº¡i</div>
          <div id="serverInfo" style="font-weight:900">-</div>
        </div>
      </div>

      <div class="courtWrap" style="margin-top:8px">
        <div class="court" id="court">
          <div class="kitchen top"></div>
          <div class="net"></div>
          <div class="kitchen bottom"></div>

          <div class="side" id="sideB" style="align-items:center">
            <div id="B_right" class="playerBox B">B - Pháº£i</div>
            <div id="B_left"  class="playerBox B">B - TrÃ¡i</div>
          </div>

          <div class="side" id="sideA" style="align-items:center">
            <div id="A_right" class="playerBox A">A - Pháº£i</div>
            <div id="A_left"  class="playerBox A">A - TrÃ¡i</div>
          </div>
        </div>
      </div>

      <div style="display:flex;gap:12px;justify-content:center;margin-top:12px">
        <div style="text-align:center">
          <div style="font-weight:900;color:var(--teamA)"><span id="teamALabel">Äá»™i A</span></div>
          <div style="margin-top:8px">
            <button class="btn small" onclick="servePoint('A')">+ Äiá»ƒm (A Ä‘ang giao)</button>
            <button class="btn small" onclick="receiverWins('A')">A tháº¯ng pha (náº¿u A lÃ  ngÆ°á»i nháº­n)</button>
            <div style="margin-top:6px"><button class="btn small" onclick="decPoint('A')">âˆ’</button></div>
          </div>
        </div>

        <div style="text-align:center">
          <div style="font-weight:900;color:var(--teamB)"><span id="teamBLabel">Äá»™i B</span></div>
          <div style="margin-top:8px">
            <button class="btn small" onclick="servePoint('B')">+ Äiá»ƒm (B Ä‘ang giao)</button>
            <button class="btn small" onclick="receiverWins('B')">B tháº¯ng pha (náº¿u B lÃ  ngÆ°á»i nháº­n)</button>
            <div style="margin-top:6px"><button class="btn small" onclick="decPoint('B')">âˆ’</button></div>
          </div>
        </div>
      </div>

      <div style="display:flex;gap:8px;justify-content:center;margin-top:12px">
        <button class="btn" onclick="manualSideOut()">Side-out thá»§ cÃ´ng</button>
        <button class="btn" onclick="showState()">Hiá»‡n tráº¡ng</button>
      </div>
    </div>
  </div>
</div>

<script>
/* ===== State ===== */
let scoreA = 0, scoreB = 0;
let servingTeam = null;     // 'A' or 'B' (team currently serving)
let servingPlayer = 1;      // 1 = right, 2 = left
let S = 0;                  // sá»‘ lÆ°á»£t giao hiá»‡n táº¡i cá»§a Ä‘á»™i Ä‘ang giao (1 hoáº·c 2)
let initialServer = null;
let matchOn = false;

/* Helpers */
const $ = id => document.getElementById(id);

function startMatch(){
  // set names
  $('A_right').textContent = $('A_right_name').value || 'A - Pháº£i';
  $('A_left').textContent  = $('A_left_name').value  || 'A - TrÃ¡i';
  $('B_right').textContent = $('B_right_name').value || 'B - Pháº£i';
  $('B_left').textContent  = $('B_left_name').value  || 'B - TrÃ¡i';

  $('teamALabel').textContent = $('teamAName').value || 'Äá»™i A';
  $('teamBLabel').textContent = $('teamBName').value || 'Äá»™i B';

  initialServer = $('firstServe').value || 'A';
  servingTeam = initialServer;
  // theo thá»a thuáº­n: Ä‘á»™i giao Ä‘áº§u tráº­n báº¯t Ä‘áº§u S = 2
  S = 2;
  servingPlayer = 1; // pháº£i giao Ä‘áº§u
  scoreA = 0; scoreB = 0;
  matchOn = true;
  updateAll();
  alert('Tráº­n báº¯t Ä‘áº§u. Äá»™i ' + servingTeam + ' giao trÆ°á»›c (S = 2). Báº£ng: ' + boardText());
}

/* Build main board text: show points from perspective of serving team */
function boardText(){
  if(!matchOn) return `${scoreA} - ${scoreB} - ${S}`;
  let sScore = (servingTeam === 'A') ? scoreA : scoreB;
  let oScore = (servingTeam === 'A') ? scoreB : scoreA;
  return `${sScore} - ${oScore} - ${S}`;
}

/* Update UI visuals */
function updateAll(){
  $('scoreA').textContent = scoreA;
  $('scoreB').textContent = scoreB;
  $('mainBoard').textContent = boardText();
  $('serverInfo').textContent = matchOn ? (`${servingTeam} â€” ${(servingPlayer===1)?'Pháº£i':'TrÃ¡i'}`) : '-';

  // update player labels (in case user edited mid-game)
  $('A_right').textContent = $('A_right_name').value || 'A - Pháº£i';
  $('A_left').textContent  = $('A_left_name').value  || 'A - TrÃ¡i';
  $('B_right').textContent = $('B_right_name').value || 'B - Pháº£i';
  $('B_left').textContent  = $('B_left_name').value  || 'B - TrÃ¡i';

  // clear server class
  ['A_right','A_left','B_right','B_left'].forEach(id => $(id).classList.remove('server'));

  // add server highlight
  if(matchOn){
    const id = (servingTeam === 'A' ? 'A_' : 'B_') + (servingPlayer === 1 ? 'right' : 'left');
    $(id).classList.add('server');
  }
}

/* Serve team scores a point (only valid if team === servingTeam) */
function servePoint(team){
  if(!matchOn){ alert('Báº¥m Báº®T Äáº¦U trÆ°á»›c khi ghi Ä‘iá»ƒm.'); return; }
  if(team !== servingTeam){ alert('Chá»‰ Ä‘á»™i Ä‘ang giao má»›i Ä‘Æ°á»£c cá»™ng Ä‘iá»ƒm. Náº¿u Ä‘á»™i kia tháº¯ng pha khi lÃ  ngÆ°á»i nháº­n, báº¥m "Receiver wins".'); return; }

  // team gets a point
  if(team === 'A') scoreA++; else scoreB++;

  // server switches side (right <-> left)
  servingPlayer = (servingPlayer === 1) ? 2 : 1;

  updateAll();
  checkWin();
}

/* When receiving team wins rally (does NOT get point, but affects serve rights)
   Rules implemented to match examples you provided:
   - If opponent (current servingTeam) loses the rally:
     - If the new team (winner) just gained serve via side-out, they start with S = 1.
     - If the team currently serving had S = 2 and lost -> side-out to opponent, opponent starts with S = 1.
     - If the serving team had S = 1 and lost -> we increase S to 2 for the same team (as per example sequence),
       i.e., the losing serving team moves from S=1 -> S=2 (still serving) â€” this is the specialized behavior to match your examples.
   This logic reproduces sequences like:
     0-0-2 (A serves) -> A scores -> 1-0-2
     -> B wins rally -> side-out to B with S=1 => 0-1-1
     -> B loses (while S=1) -> B remains server but S becomes 2 => 0-1-2
     -> B loses again (S=2) -> side-out to A start with S=1 => 1-0-1
*/
function receiverWins(winnerTeam){
  if(!matchOn){ alert('Báº¯t Ä‘áº§u tráº­n trÆ°á»›c (Báº®T Äáº¦U).'); return; }
  if(winnerTeam === servingTeam){
    alert('Äá»™i nÃ y Ä‘ang giao. Náº¿u há» ghi Ä‘iá»ƒm, báº¥m + Äiá»ƒm (Serve).');
    return;
  }

  // current serving team lost the rally
  // Decide transition
  // If current serving team had S == 2 => side-out to winnerTeam, winnerTeam starts with S=1
  if(S === 2){
    servingTeam = winnerTeam;
    S = 1;
    servingPlayer = 1; // right serves first when gaining serve
  } else if(S === 1){
    // If serving team had S==1 and lost -> increase S to 2 for the same (current) team (special rule to match your example)
    // i.e., the serving team remains serving but S becomes 2
    // However since winnerTeam != servingTeam, interpreting your example: after winnerTeam wins and becomes server with S=1,
    // then if that new server "loses" next rally, their S goes from 1 -> 2 (they still remain server).
    // To model exactly the example timeline, we interpret as:
    // - When winnerTeam wins, we set servingTeam = winnerTeam and S=1 (handled above only when previous S==2).
    // But if S was 1 (meaning previous server had S=1) and they lost, we do:
    //   servingTeam stays as winnerTeam (already set if changed) and then S becomes 2.
    // For simplicity and to follow the exact example sequence, apply:
    servingTeam = winnerTeam;
    // If winnerTeam just gained serve previously with S==1 and now loses, we'll set S=2
    S = 2;
    servingPlayer = 1;
  } else {
    // fallback
    servingTeam = winnerTeam;
    S = 1;
    servingPlayer = 1;
  }

  updateAll();
}

/* Manual side-out (for correction) */
function manualSideOut(){
  if(!matchOn){ alert('Báº¯t Ä‘áº§u tráº­n trÆ°á»›c (Báº®T Äáº¦U).'); return; }
  servingTeam = (servingTeam === 'A') ? 'B' : 'A';
  S = 1;
  servingPlayer = 1;
  updateAll();
}

/* Decrease point manually */
function decPoint(team){
  if(team === 'A' && scoreA>0) scoreA--;
  if(team === 'B' && scoreB>0) scoreB--;
  updateAll();
}

/* Check win condition */
function checkWin(){
  const pt = $('pointType').value; // '11' or '15'
  const winType = $('winType').value; // 'touch' or 'by2'
  const cap = (pt === '11') ? 15 : 21;
  const target = (winType === 'touch') ? Number(pt) : Number(cap);

  if(scoreA >= target || scoreB >= target){
    if(winType === 'by2'){
      if(Math.abs(scoreA - scoreB) >= 2 || scoreA >= cap || scoreB >= cap){
        announceWinner();
      }
    } else {
      announceWinner();
    }
  }
}

function announceWinner(){
  const winnerName = (scoreA > scoreB) ? ($('teamAName').value || 'Äá»™i A') : ($('teamBName').value || 'Äá»™i B');
  alert('ğŸ‰ ' + winnerName + ' tháº¯ng tráº­n! ğŸ‰');
  matchOn = false;
  updateAll();
}

function showState(){
  alert(
    `State:
matchOn: ${matchOn}
servingTeam: ${servingTeam}
servingPlayer: ${servingPlayer===1 ? 'Pháº£i' : 'TrÃ¡i'}
S (lÆ°á»£t Ä‘ang giao): ${S}
scoreA - scoreB: ${scoreA} - ${scoreB}`
  );
}

/* init */
updateAll();
</script>
</body>
</html>
