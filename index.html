<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>PICKLEBALL SCORE - Äá»¨C TRá»ŒNG</title>
<style>
  :root{
    --bg:#f4f7fb; --card:#fff; --muted:#6b7280;
    --teamA:#007bff; --teamB:#ff4757;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,Arial,Helvetica,sans-serif;background:var(--bg);-webkit-text-size-adjust:100%}
  .wrap{max-width:980px;margin:14px auto;padding:12px}
  header{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
  h1{margin:0;background:#083d9a;color:#fff;padding:10px 14px;border-radius:8px;font-size:18px}
  .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  label{font-size:13px;color:var(--muted)}
  select,input{padding:8px;border-radius:8px;border:1px solid #d7dde6}
  .btn{padding:8px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:700}
  .btn.green{background:#00a850;color:#fff}
  .layout{display:flex;gap:12px;margin-top:12px;align-items:flex-start}
  .left{width:360px;background:var(--card);padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
  .right{flex:1;background:var(--card);padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
  .teamBox{padding:10px;border-radius:8px;margin-bottom:10px;border-left:8px solid #ddd;background:#fbfbfb}
  .teamA{border-left-color:var(--teamA)} .teamB{border-left-color:var(--teamB)}
  .small{font-size:13px;color:var(--muted)}
  .bigScore{font-size:28px;font-weight:900}
  .courtWrap{display:flex;justify-content:center;align-items:center;padding:8px}
  /* Horizontal court */
  .court{width:100%;max-width:700px;height:320px;background:#d7f0d9;border:4px solid #2b4b2b;border-radius:10px;position:relative;display:flex;overflow:hidden}
  .leftHalf,.rightHalf{width:50%;height:100%;position:relative;display:flex;flex-direction:column;justify-content:center;align-items:center}
  /* vertical net in middle */
  .net{position:absolute;left:50%;top:0;bottom:0;width:6px;background:#333;transform:translateX(-50%)}
  /* NVZ (kitchen) â€” vertical strips on both sides of net */
  .nvz-left{position:absolute;left:43%;top:0;bottom:0;width:14%;background:rgba(255,200,0,0.12);border-left:2px dashed rgba(0,0,0,0.08);border-right:2px dashed rgba(0,0,0,0.08)}
  .nvz-right{position:absolute;left:43% + 0px; /* not used */ }
  .nvz-right{position:absolute;left:50%;width:14%;top:0;bottom:0;background:rgba(255,200,0,0.12);border-left:2px dashed rgba(0,0,0,0.08);border-right:2px dashed rgba(0,0,0,0.08);transform:translateX(0)}
  /* Player boxes inside each half: near (inner/near net) and far (outer) */
  .player{position:absolute;width:48%;height:46px;border-radius:8px;background:#fff;display:flex;align-items:center;justify-content:center;font-weight:800;border:2px solid rgba(0,0,0,0.06);transition:transform .14s, box-shadow .14s}
  .teamAcolor{color:var(--teamA);border-color:rgba(0,123,255,0.18)}
  .teamBcolor{color:var(--teamB);border-color:rgba(255,71,87,0.18)}
  .server{background:#ffdede;border-color:#ff5b5b !important;color:#7a0000;transform:scale(1.06);box-shadow:0 12px 28px rgba(0,0,0,0.12)}
  /* A-side positions (left half) */
  #A-near{left:6%; top:35%}    /* near net (this is 'pháº£i' position for team A) */
  #A-far {left:6%; bottom:35%}  /* far from net (this is 'trÃ¡i') */
  /* B-side positions (right half) */
  #B-near{right:6%; top:35%}   /* near net (this is 'pháº£i' for team B) */
  #B-far {right:6%; bottom:35%} /* far from net ('trÃ¡i') */

  .board{margin-top:12px;text-align:center}
  .mainBoard{display:inline-block;background:#fff;padding:8px 14px;border-radius:8px;font-weight:900}
  .controlsRow{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  button.small{padding:8px 10px;border-radius:8px;border:0;cursor:pointer}
  .muted{color:var(--muted);font-size:13px}
  .flex-between{display:flex;justify-content:space-between;align-items:center}
  @media (max-width:880px){.layout{flex-direction:column}.left{width:100%}.court{height:380px}}
  input.small{padding:8px;border-radius:8px;border:1px solid #ddd}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>PICKLEBALL SCORE - Äá»¨C TRá»ŒNG</h1>
    <div class="controls">
      <label class="small">Thang Ä‘iá»ƒm</label>
      <select id="pointType"><option value="11">11</option><option value="15">15</option></select>

      <label class="small">Kiá»ƒu tháº¯ng</label>
      <select id="winType"><option value="touch">Cháº¡m</option><option value="by2">CÃ¡ch 2</option></select>

      <label class="small">Äá»™i giao Ä‘áº§u</label>
      <select id="firstServe"><option value="A">Äá»™i A</option><option value="B">Äá»™i B</option></select>

      <button class="btn green" onclick="startMatch()">Báº®T Äáº¦U</button>
    </div>
  </header>

  <div class="layout">
    <!-- LEFT: settings -->
    <div class="left">
      <div class="teamBox teamA">
        <div class="flex-between">
          <div>
            <div style="font-weight:900">Äá»™i A</div>
            <div class="small">TÃªn Ä‘á»™i: <input id="teamAName" class="small" value="TEAM A"></div>
          </div>
          <div style="text-align:right">
            <div class="small">Äiá»ƒm</div>
            <div id="scoreA" class="bigScore">0</div>
          </div>
        </div>
        <div style="margin-top:8px">
          <div class="small">VÄV (pháº£i = NGAY Gáº¦N LÆ¯á»šI / trÃ¡i = XA LÆ¯á»šI)</div>
          <input id="A_right" class="small" value="A - Pháº£i" style="width:100%;margin-top:6px">
          <input id="A_left"  class="small" value="A - TrÃ¡i" style="width:100%;margin-top:6px">
        </div>
      </div>

      <div class="teamBox teamB">
        <div class="flex-between">
          <div>
            <div style="font-weight:900">Äá»™i B</div>
            <div class="small">TÃªn Ä‘á»™i: <input id="teamBName" class="small" value="TEAM B"></div>
          </div>
          <div style="text-align:right">
            <div class="small">Äiá»ƒm</div>
            <div id="scoreB" class="bigScore">0</div>
          </div>
        </div>
        <div style="margin-top:8px">
          <div class="small">VÄV (pháº£i = NGAY Gáº¦N LÆ¯á»šI / trÃ¡i = XA LÆ¯á»šI)</div>
          <input id="B_right" class="small" value="B - Pháº£i" style="width:100%;margin-top:6px">
          <input id="B_left"  class="small" value="B - TrÃ¡i" style="width:100%;margin-top:6px">
        </div>
      </div>

      <div style="margin-top:12px">
        <div class="muted">Báº£ng chÃ­nh: <span class="small">(Ä‘iá»ƒm Ä‘á»™i Ä‘ang giao - Ä‘iá»ƒm Ä‘á»‘i phÆ°Æ¡ng - S)</span></div>
        <div class="board" style="margin-top:8px"><div id="mainBoard" class="mainBoard">0 - 0 - 0</div></div>
        <div style="margin-top:8px" class="muted">Ghi chÃº: Ä‘á»™i giao Ä‘áº§u tráº­n <b>báº¯t Ä‘áº§u S=1</b> theo luáº­t tiÃªu chuáº©n; khi serve chuyá»ƒn sang Ä‘á»™i khÃ¡c thÃ¬ Ä‘á»™i Ä‘Ã³ cÃ³ S=2.</div>
      </div>
    </div>

    <!-- RIGHT: court & controls -->
    <div class="right">
      <div class="flex-between">
        <div style="font-weight:900">SÃ¢n (ngang)</div>
        <div style="text-align:right">
          <div class="small">Server</div>
          <div id="serverInfo" style="font-weight:900">-</div>
        </div>
      </div>

      <div class="courtWrap" style="margin-top:10px">
        <div class="court" id="court">
          <div class="nvz-left" aria-hidden="true"></div>
          <div class="net" aria-hidden="true"></div>
          <div class="nvz-right" aria-hidden="true"></div>

          <!-- A side (left half) -->
          <div id="A-near" class="player teamAcolor">A - Near</div>
          <div id="A-far"  class="player teamAcolor">A - Far</div>

          <!-- B side (right half) -->
          <div id="B-near" class="player teamBcolor">B - Near</div>
          <div id="B-far"  class="player teamBcolor">B - Far</div>
        </div>
      </div>

      <div style="display:flex;gap:12px;justify-content:center;margin-top:14px;flex-wrap:wrap">
        <div style="text-align:center">
          <div style="font-weight:900;color:var(--teamA)"><span id="lblA">Äá»™i A</span></div>
          <div style="margin-top:8px">
            <button class="btn small" onclick="servePoint('A')">+ Äiá»ƒm (A náº¿u Ä‘ang giao)</button>
            <button class="btn small" onclick="receiverWins('A')">Receiver wins (A náº¿u lÃ  ngÆ°á»i nháº­n)</button>
            <div style="margin-top:6px"><button class="btn small" onclick="decPoint('A')">âˆ’</button></div>
          </div>
        </div>

        <div style="text-align:center">
          <div style="font-weight:900;color:var(--teamB)"><span id="lblB">Äá»™i B</span></div>
          <div style="margin-top:8px">
            <button class="btn small" onclick="servePoint('B')">+ Äiá»ƒm (B náº¿u Ä‘ang giao)</button>
            <button class="btn small" onclick="receiverWins('B')">Receiver wins (B náº¿u lÃ  ngÆ°á»i nháº­n)</button>
            <div style="margin-top:6px"><button class="btn small" onclick="decPoint('B')">âˆ’</button></div>
          </div>
        </div>
      </div>

      <div style="display:flex;gap:8px;justify-content:center;margin-top:12px">
        <button class="btn" onclick="manualSideOut()">Side-out thá»§ cÃ´ng</button>
        <button class="btn" onclick="showState()">Hiá»‡n tráº¡ng</button>
      </div>
    </div>
  </div>
</div>

<script>
/* ===== State ===== */
let scoreA = 0, scoreB = 0;
let servingTeam = null;      // 'A' or 'B'
let S = 0;                   // sá»‘ lÆ°á»£t giao cÃ²n láº¡i cho Ä‘á»™i Ä‘ang giao (1 hoáº·c 2)
let initialTeam = null;      // Ä‘á»™i giao Ä‘áº§u tráº­n (chá»‰ cÃ³ 1 quyá»n)
let serverIndex = { A: 0, B: 0 }; // which player index currently on NEAR/RIGHT: 0 = right/near, 1 = left/far
// Note: we keep players fixed (A_right input maps to index 0 "near", A_left index 1 "far").
// The "server" is the player currently in the near position if they are serving by index.

let matchOn = false;

/* DOM helpers */
const $ = id => document.getElementById(id);

/* Start match */
function startMatch(){
  // load names
  $('A-near').textContent = $('A_right').value || 'A - Pháº£i';
  $('A-far').textContent  = $('A_left').value  || 'A - TrÃ¡i';
  $('B-near').textContent = $('B_right').value || 'B - Pháº£i';
  $('B-far').textContent  = $('B_left').value  || 'B - TrÃ¡i';
  $('lblA').textContent = $('teamAName').value || 'Äá»™i A';
  $('lblB').textContent = $('teamBName').value || 'Äá»™i B';

  // init
  scoreA = 0; scoreB = 0;
  initialTeam = $('firstServe').value || 'A';
  servingTeam = initialTeam;

  // According to standard doubles rules: team that serves first has only 1 serving turn
  S = 1; // initial server team has S = 1
  // For both teams we treat index 0 as "near (pháº£i)"; index 1 as "far (trÃ¡i)".
  // Initially the 'right' (near) players are indices 0; they serve first.
  serverIndex.A = 0;
  serverIndex.B = 0;

  matchOn = true;
  updateUI();
  alert('Tráº­n báº¯t Ä‘áº§u. Äá»™i ' + servingTeam + ' giao trÆ°á»›c (Ä‘á»™i Ä‘áº§u tráº­n S=1). Báº£ng: ' + boardText());
}

/* Build board text X - Y - S from serving team perspective */
function boardText(){
  if(!matchOn) return `${scoreA} - ${scoreB} - ${S}`;
  const sScore = (servingTeam === 'A') ? scoreA : scoreB;
  const oScore = (servingTeam === 'A') ? scoreB : scoreA;
  return `${sScore} - ${oScore} - ${S}`;
}

/* Update UI visuals */
function updateUI(){
  // scores
  $('scoreA').textContent = scoreA;
  $('scoreB').textContent = scoreB;
  $('mainBoard').textContent = boardText();
  $('serverInfo').textContent = matchOn ? (servingTeam + ' â€” ' + ((serverIndex[servingTeam]===0)?'Pháº£i (gáº§n lÆ°á»›i)':'TrÃ¡i (xa lÆ°á»›i)')) : '-';

  // update player names (in case edited)
  $('A-near').textContent = $('A_right').value || 'A - Pháº£i';
  $('A-far').textContent  = $('A_left').value  || 'A - TrÃ¡i';
  $('B-near').textContent = $('B_right').value || 'B - Pháº£i';
  $('B-far').textContent  = $('B_left').value  || 'B - TrÃ¡i';

  // remove server highlight
  ['A-near','A-far','B-near','B-far'].forEach(id => $(id).classList.remove('server'));
  // add server highlight (player who is currently serving)
  if(matchOn){
    const team = servingTeam;
    const idx  = serverIndex[team]; // 0 = near, 1 = far
    const id = (team === 'A' ? (idx===0 ? 'A-near' : 'A-far') : (idx===0 ? 'B-near' : 'B-far'));
    $(id).classList.add('server');
  }
}

/* Serve point: only valid when team === servingTeam */
function servePoint(team){
  if(!matchOn){ alert('Báº¥m Báº®T Äáº¦U trÆ°á»›c khi ghi Ä‘iá»ƒm.'); return; }
  if(team !== servingTeam){ alert('Chá»‰ Ä‘á»™i Ä‘ang giao má»›i Ä‘Æ°á»£c cá»™ng Ä‘iá»ƒm. Náº¿u Ä‘á»™i nháº­n tháº¯ng pha, báº¥m "Receiver wins" cho há».'); return; }

  // +1 point
  if(team === 'A') scoreA++; else scoreB++;

  // server (the player currently in near position) switches side: near <-> far
  serverIndex[team] = 1 - serverIndex[team];

  // when serving team scores, S does NOT change
  updateUI();
  checkWin();
}

/* Receiver wins rally (winning team is winnerTeam, but they are the team that was receiving) */
function receiverWins(winnerTeam){
  if(!matchOn){ alert('Báº¯t Ä‘áº§u tráº­n trÆ°á»›c (Báº®T Äáº¦U).'); return; }
  // if they are actually the serving team, tell user to use servePoint
  if(winnerTeam === servingTeam){
    alert('Äá»™i nÃ y Ä‘ang giao. Náº¿u há» ghi Ä‘iá»ƒm, báº¥m + Äiá»ƒm (Serve).');
    return;
  }

  // Current serving team lost the rally.
  // According to standard doubles rules implementation with S meaning "serves remaining for serving team":
  // - If serving team currently had S === 2: then they lose one serve => S becomes 1 and partner will now serve (serverIndex toggled).
  // - If serving team currently had S === 1: then side-out (serve passes to opponent). Opponent becomes servingTeam and their S = 2 (except if opponent is initial team but initial team only had 1 at match start; initialTeam flag only relevant at very first service).
  //
  // We also have an 'initialTeam' for which S was set to 1 at match start. After the first time that initialTeam loses serve, normal 2-serve-per-team rule applies for everyone.

  if(S === 2){
    // serving team still retains serve but loses one serve (i.e., partner will now serve)
    S = 1;
    // partner serves next (toggle the server index within the same team)
    serverIndex[servingTeam] = 1 - serverIndex[servingTeam];
    // servingTeam remains unchanged
  } else if(S === 1){
    // side-out: serve goes to winnerTeam
    // After side-out, the new serving team typically starts with S = 2 (except the very first initial team case which we already set at start)
    servingTeam = winnerTeam;
    S = 2;
    // by rule the player on the near position (index 0) serves first when a team gains serve
    serverIndex[servingTeam] = 0;
    // If the team gaining serve is the initialTeam at the very first serve? That case handled at start (initial team had S=1 at start)
  } else {
    // fallback (shouldn't occur)
    servingTeam = winnerTeam;
    S = 2;
    serverIndex[servingTeam] = 0;
  }

  updateUI();
}

/* Manual side-out (for correction) */
function manualSideOut(){
  if(!matchOn){ alert('Báº¯t Ä‘áº§u tráº­n trÆ°á»›c (Báº®T Äáº¦U).'); return; }
  servingTeam = (servingTeam === 'A') ? 'B' : 'A';
  // when side-out to new team, they normally have S=2 (unless you want special initial behaviour)
  S = 2;
  serverIndex[servingTeam] = 0;
  updateUI();
}

/* Manual decrement point */
function decPoint(team){
  if(team === 'A' && scoreA>0) scoreA--;
  if(team === 'B' && scoreB>0) scoreB--;
  updateUI();
}

/* Check win conditions */
function checkWin(){
  const pt = $('pointType').value; // '11' or '15'
  const winType = $('winType').value; // 'touch' or 'by2'
  const cap = (pt === '11') ? 15 : 21;
  const target = (winType === 'touch') ? Number(pt) : Number(cap);

  if(scoreA >= target || scoreB >= target){
    if(winType === 'by2'){
      // need difference >=2 or cap reached
      if(Math.abs(scoreA - scoreB) >= 2 || scoreA >= cap || scoreB >= cap){
        announceWinner();
      }
    } else {
      announceWinner();
    }
  }
}

function announceWinner(){
  const winner = (scoreA > scoreB) ? ($('teamAName').value || 'Äá»™i A') : ($('teamBName').value || 'Äá»™i B');
  alert('ğŸ‰ ' + winner + ' tháº¯ng tráº­n! ğŸ‰');
  matchOn = false;
  updateUI();
}

/* Debug / show state */
function showState(){
  alert(`State:
matchOn: ${matchOn}
initialTeam: ${initialTeam}
servingTeam: ${servingTeam}
S (serves remaining for serving team): ${S}
serverIndex (0=near/right,1=far/left): A=${serverIndex.A}, B=${serverIndex.B}
scoreA - scoreB: ${scoreA} - ${scoreB}`);
}

/* Initialize UI */
updateUI();
</script>
</body>
</html>
